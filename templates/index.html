>
  :root {
    --bg:#0f1115;--panel:#11131a;--card:#151721;--text:#e6eef6;
    --muted:#98a0b3;--accent1:#2dd4bf;--accent2:#22c55e;
    --blur:0px;--shadow:none;--radius:10px;
  }
  body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);}
  .container{max-width:920px;margin:28px auto;padding:20px;}
  h1{margin:0 0 10px;font-size:22px;}
  select,input[type="text"],button{transition:all .3s ease;}
  input[type="text"],select{
    background:var(--panel);border:1px solid #222632;color:inherit;
    padding:10px 12px;border-radius:var(--radius);
  }
  button{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    border:none;color:#071019;padding:10px 12px;border-radius:var(--radius);
    cursor:pointer;font-weight:600;display:flex;align-items:center;gap:6px;
  }
  button:hover{filter:brightness(1.1);}
  button.secondary{background:transparent;border:1px solid #2b3242;color:var(--muted);}
  .panel{background:var(--card);border:1px solid #1e222b;padding:14px;border-radius:var(--radius);margin-top:14px;}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
  .progress{background:#0b0d11;border:1px solid #222632;border-radius:8px;height:22px;position:relative;overflow:hidden;margin-top:4px;}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .35s ease;}
  .percent{position:absolute;left:50%;top:0;transform:translateX(-50%);font-size:12px;font-weight:700;color:#071019;line-height:22px;}
  .note{font-size:13px;color:var(--muted);margin-top:8px;}
  .thumb{max-width:220px;border-radius:8px;margin-top:12px;display:none;border:1px solid #222632;}
  .metric{min-width:90px;color:var(--muted);font-size:13px;}
  .spinner{width:14px;height:14px;border-radius:50%;border:2px solid #22313a;border-top:2px solid var(--accent2);display:inline-block;animation:spin .9s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg);}}
  @keyframes redGlow{0%{box-shadow:0 0 6px red;}100%{box-shadow:0 0 20px red;}}
  @keyframes greenPulse{0%{box-shadow:0 0 8px #22c55e;}100%{box-shadow:0 0 20px #22c55e;}}
  .cancel-glow{animation:redGlow 1s infinite alternate;}
  .reset-pulse{animation:greenPulse 1s 2 alternate;}
  .bubble{background:#2b1616;color:#ffd6d6;border-radius:6px;padding:8px 10px;font-size:13px;margin-top:8px;display:none;}
</style>
</head>
<body>
<div class="container">
  <div class="theme-switcher" style="display:flex;justify-content:flex-end;margin-bottom:16px;">
    <label for="theme" style="margin-right:8px;">üé® Theme:</label>
    <select id="theme">
      <option value="glass">Glassmorphism (Blue)</option>
      <option value="neonorange">Neon Cyber (Orange)</option>
      <option value="neon">Neon Cyber (Purple)</option>
      <option value="flat">Flat Minimal (Gray)</option>
    </select>
  </div>

  <h1>YouTube Downloader</h1>
  <div class="panel">
    <div class="row">
      <input id="url" type="text" placeholder="Paste YouTube URL" />
      <button id="fetch-btn" onclick="fetchInfo()">Fetch Info</button>
    </div>
    <div id="bubble" class="bubble"></div>

    <div id="info-area" style="display:none;margin-top:12px;">
      <div class="row">
        <div style="flex:1;">
          <div class="note">üéûÔ∏è Video formats</div>
          <select id="video"></select>
        </div>
        <div style="flex:1;">
          <div class="note">üéß Audio formats</div>
          <select id="audio"></select>
        </div>
        <div style="min-width:180px;"><img id="thumbnail" class="thumb" alt="thumbnail" /></div>
      </div>
      <div class="controls">
        <button id="audio-btn" onclick="startAudio()">Download Audio</button>
        <button id="video-btn" onclick="startVideo()">Download Video</button>
        <button id="cancel-btn" class="secondary" onclick="cancelDownload()" style="display:none;">‚ùå Cancel</button>
        <button id="reset-btn" class="secondary" onclick="resetApp()" style="display:none;">üîÅ Reset</button>
      </div>
    </div>

    <div id="status" class="note">‚è≥ Waiting for input‚Ä¶</div>
    <div id="complete" class="note" style="font-weight:600;margin-top:6px;"></div>
  </div>

  <div id="progress-panel" class="panel" style="display:none;">
    <h3 style="margin:0 0 8px 0;">Progress</h3>
    <div id="video-section">
      <div class="note">Video Progress</div>
      <div class="progress"><div id="video-bar" class="bar"></div><div id="video-percent" class="percent">0%</div></div>
      <div class="row"><div class="metric" id="video-eta">ETA: ‚Äî</div><div class="metric" id="video-speed">Speed: ‚Äî</div><div class="metric" id="video-size">Size: ‚Äî</div><div class="metric" id="video-status">Status: ‚Äî</div></div>
    </div>
    <div id="audio-section" style="margin-top:10px;">
      <div class="note">Audio Progress</div>
      <div class="progress"><div id="audio-bar" class="bar"></div><div id="audio-percent" class="percent">0%</div></div>
      <div class="row"><div class="metric" id="audio-eta">ETA: ‚Äî</div><div class="metric" id="audio-speed">Speed: ‚Äî</div><div class="metric" id="audio-size">Size: ‚Äî</div><div class="metric" id="audio-status">Status: ‚Äî</div></div>
    </div>
    <div id="merge-section" style="margin-top:10px;">
      <div class="note">Merging Progress</div>
      <div class="progress"><div id="merge-bar" class="bar"></div><div id="merge-percent" class="percent">0%</div></div>
      <div class="row"><div class="metric" id="merge-eta">ETA: ‚Äî</div><div class="metric" id="merge-speed">Speed: ‚Äî</div><div class="metric" id="merge-size">Size: ‚Äî</div><div class="metric" id="merge-status">Status: ‚Äî</div></div>
    </div>
  </div>
</div>

<script>
const el=id=>document.getElementById(id);
const setText=(id,t)=>{if(el(id))el(id).textContent=t;};

function showBubble(msg){const b=el("bubble");b.textContent=msg;b.style.display="block";setTimeout(()=>b.style.display="none",3000);}

// ---- THEMES ----
const themes={
  glass:{"--bg":"#0e1119","--panel":"rgba(255,255,255,0.05)","--card":"rgba(255,255,255,0.07)","--text":"#eaf6ff","--muted":"#a7b3c8","--accent1":"#60a5fa","--accent2":"#38bdf8"},
  neonorange:{"--bg":"#140800","--panel":"#1f0b00","--card":"#2c1000","--text":"#ffe8d1","--muted":"#ffb56b","--accent1":"#f97316","--accent2":"#fb923c"},
  neon:{"--bg":"#0a0014","--panel":"#120025","--card":"#1c0038","--text":"#e6d9ff","--muted":"#aa8be8","--accent1":"#c026d3","--accent2":"#9333ea"},
  flat:{"--bg":"#f3f3f3","--panel":"#fff","--card":"#fff","--text":"#111","--muted":"#666","--accent1":"#9ca3af","--accent2":"#6b7280"}
};
const root=document.documentElement;const select=el("theme");
function applyTheme(t){const v=themes[t];for(const k in v)root.style.setProperty(k,v[k]);}
select.addEventListener("change",()=>{applyTheme(select.value);localStorage.setItem("theme",select.value);});
applyTheme(localStorage.getItem("theme")||"glass");select.value=localStorage.getItem("theme")||"glass";

// ---- Spinner Control ----
function showSpinner(btnId,text){
  const btn=el(btnId);btn.disabled=true;btn.innerHTML=`<span class="spinner"></span>${text}`;
}
function hideSpinner(btnId,text){
  const btn=el(btnId);btn.disabled=false;btn.textContent=text;
}

// ---- FETCH ----
function fetchInfo(){
  const url=el("url").value.trim();
  if(!url){showBubble("Please enter a URL");return;}
  showSpinner("fetch-btn","Fetching...");
  fetch("/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url})})
  .then(r=>r.json()).then(d=>{
    hideSpinner("fetch-btn","Fetch Info");
    if(d.status!=="info_fetched"){showBubble("Fetch failed");return;}
    populateInfo(d.info);setText("status","‚úÖ Info loaded. Choose format or start download.");
  }).catch(e=>{hideSpinner("fetch-btn","Fetch Info");showBubble("Fetch error: "+e);});
}

function populateInfo(info){
  el("info-area").style.display="block";
  if(info.thumbnail){el("thumbnail").src=info.thumbnail;el("thumbnail").style.display="block";}
  el("video").innerHTML=info.video_formats.map(f=>`<option value="${f.format_id}">${f.resolution||"?"} (${f.ext})</option>`).join("");
  el("audio").innerHTML=info.audio_formats.map(f=>`<option value="${f.format_id}">${f.abr||"?"} kbps (${f.ext})</option>`).join("");
}

// ---- DOWNLOAD ----
let mode=null;
function startAudio(){
  mode="audio";setText("complete","");
  showSpinner("audio-btn","Downloading...");
  fetch("/download_audio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:el("url").value})});
  el("progress-panel").style.display="block";
  el("audio-section").style.display="block";
  el("video-section").style.display="none";
  el("merge-section").style.display="none";
  el("cancel-btn").style.display="inline-flex";
  el("reset-btn").style.display="inline-flex";
  el("cancel-btn").classList.add("cancel-glow");
  pollProgress();
}
function startVideo(){
  mode="video";setText("complete","");
  showSpinner("video-btn","Downloading...");
  fetch("/download_video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:el("url").value})});
  el("progress-panel").style.display="block";
  el("audio-section").style.display="block";
  el("video-section").style.display="block";
  el("merge-section").style.display="block";
  el("cancel-btn").style.display="inline-flex";
  el("reset-btn").style.display="inline-flex";
  el("cancel-btn").classList.add("cancel-glow");
  pollProgress();
}

function pollProgress(){
  fetch("/progress").then(r=>r.json()).then(updateProgress);
  if(mode) setTimeout(pollProgress,1000);
}

function updateProgress(p){
  ["video","audio","merge"].forEach(type=>{
    const bar=el(`${type}-bar`),per=el(`${type}-percent`);const s=p[type];if(!s)return;
    bar.style.width=s.percent||"0%";per.textContent=s.percent||"0%";
    setText(`${type}-eta`,"ETA: "+(s.eta||"‚Äî"));
    setText(`${type}-speed`,"Speed: "+(s.speed||"‚Äî"));
    setText(`${type}-size`,"Size: "+(s.size||"‚Äî"));
    setText(`${type}-status`,"Status: "+(s.status||"‚Äî"));
    if(s.percent==="100%"){checkDone();}
  });
}

function checkDone(){
  fetch("/done").then(r=>r.json()).then(d=>{
    if(d.filename){
      setText("complete","‚úÖ Download done ‚Äî "+d.filename);
      hideSpinner("audio-btn","Download Audio");
      hideSpinner("video-btn","Download Video");
      el("cancel-btn").classList.remove("cancel-glow");
      mode=null;
    }
  });
}

function cancelDownload(){
  fetch("/cancel",{method:"POST"});
  setText("status","‚ùå Cancelled");
  hideSpinner("audio-btn","Download Audio");
  hideSpinner("video-btn","Download Video");
  el("cancel-btn").classList.remove("cancel-glow");
  mode=null;
}
function resetApp(){
  fetch("/reset",{method:"POST"});
  el("reset-btn").classList.add("reset-pulse");
  setTimeout(()=>location.reload(),600);
}
</script>
</body>
</html>
