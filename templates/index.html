<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube Downloader ‚Äî Multi Theme</title>
<style>
  :root {
    --bg:#0f1115;--panel:#11131a;--card:#151721;
    --text:#e6eef6;--muted:#98a0b3;
    --accent1:#2dd4bf;--accent2:#22c55e;
    --blur:0px;--shadow:none;--radius:10px;
    transition: all .4s ease;
  }
  body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);}
  .container{max-width:920px;margin:28px auto;padding:20px;}
  h1{margin:0 0 10px;font-size:22px;}
  select,input[type="text"],button{transition:all .3s ease;}
  input[type="text"],select{
    background:var(--panel);border:1px solid #222632;color:inherit;
    padding:10px 12px;border-radius:var(--radius);backdrop-filter:blur(var(--blur));
  }
  button{
    background:linear-gradient(90deg,var(--accent1),var(--accent2));
    border:none;color:#071019;padding:10px 12px;border-radius:var(--radius);
    cursor:pointer;font-weight:600;box-shadow:var(--shadow);
    display:flex;align-items:center;justify-content:center;gap:6px;
  }
  button:hover{filter:brightness(1.1);}
  button.secondary{background:transparent;border:1px solid #2b3242;color:var(--muted);}
  /* cancel red glow */
  .cancel-glow{
    border:1px solid #ff4747 !important;
    color:#ffb3b3 !important;
    box-shadow:0 0 10px rgba(255,50,50,0.6),0 0 25px rgba(255,50,50,0.4) !important;
    animation:cancelPulse 1.2s infinite alternate;
  }
  @keyframes cancelPulse{
    0%{box-shadow:0 0 10px rgba(255,50,50,0.5),0 0 20px rgba(255,50,50,0.3);}
    100%{box-shadow:0 0 20px rgba(255,70,70,0.9),0 0 35px rgba(255,50,50,0.6);}
  }
  /* reset green pulse */
  .reset-pulse{
    animation:resetPulse 0.8s ease-out;
    border:1px solid #22c55e !important;
    color:#22c55e !important;
    box-shadow:0 0 12px rgba(34,197,94,0.6) !important;
  }
  @keyframes resetPulse{
    0%{box-shadow:0 0 0 rgba(34,197,94,0);}
    50%{box-shadow:0 0 15px rgba(34,197,94,0.8);}
    100%{box-shadow:0 0 0 rgba(34,197,94,0);}
  }
  .panel{background:var(--card);border:1px solid #1e222b;padding:14px;border-radius:var(--radius);margin-top:14px;}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
  .progress{background:#0b0d11;border:1px solid #222632;border-radius:8px;height:22px;position:relative;overflow:hidden;}
  .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width .35s ease;}
  .percent{position:absolute;left:50%;top:0;transform:translateX(-50%);font-size:12px;font-weight:700;color:#071019;line-height:22px;}
  .note{font-size:13px;color:var(--muted);margin-top:8px;}
  .thumb{max-width:200px;border-radius:8px;margin-top:12px;border:1px solid #222632;display:none;}
  .metric{min-width:90px;color:var(--muted);font-size:13px;}
  .spinner{width:14px;height:14px;border-radius:50%;border:2px solid #22313a;border-top:2px solid var(--accent2);display:inline-block;animation:spin .9s linear infinite;vertical-align:middle;}
  .loading{animation:pulseGlow 1.2s infinite alternate ease-in-out;box-shadow:0 0 12px var(--accent2),0 0 25px var(--accent2);}
  @keyframes spin{to{transform:rotate(360deg);}}
  @keyframes pulseGlow{0%{box-shadow:0 0 6px var(--accent2),0 0 15px var(--accent2);}100%{box-shadow:0 0 18px var(--accent2),0 0 35px var(--accent2);}}
</style>
</head>
<body>
<div class="container">
  <h1>YouTube Downloader</h1>

  <div class="panel">
    <div class="row">
      <input id="url" type="text" placeholder="Paste YouTube URL" />
      <button id="fetch-btn" onclick="fetchInfo()">Fetch Info</button>
    </div>

    <div id="fetched-area" style="display:none;margin-top:12px;">
      <div class="row">
        <div style="flex:1;">
          <div class="note">üé¨ Video formats</div>
          <select id="video"></select>
        </div>
        <div style="flex:1;">
          <div class="note">üéß Audio formats</div>
          <select id="audio"></select>
        </div>
        <div style="min-width:180px;">
          <img id="thumbnail" class="thumb" alt="Thumbnail" />
        </div>
      </div>

      <div class="controls">
        <button id="audio-btn" onclick="startAudio()">Download Audio</button>
        <button id="video-btn" onclick="startVideo()">Download Video</button>
        <button id="cancel-btn" class="secondary" onclick="cancelDownload()">Cancel</button>
        <button id="reset-btn" class="secondary" onclick="resetApp()">Reset</button>
      </div>
    </div>

    <div id="status" class="note" style="margin-top:10px;">‚è≥ Waiting for input‚Ä¶</div>
    <div id="complete"></div>
  </div>

  <div id="progress-section" class="panel" style="display:none;">
    <h3 style="margin:0 0 8px 0;">Progress</h3>
    <div class="progress">
      <div id="video-bar" class="bar"></div>
      <div id="video-percent" class="percent">0%</div>
    </div>
    <div class="row" style="margin-top:8px;">
      <div class="metric" id="video-eta">ETA: ‚Äî</div>
      <div class="metric" id="video-speed">Speed: ‚Äî</div>
      <div class="metric" id="video-size">Size: ‚Äî</div>
      <div class="metric" id="video-status">Status: ‚Äî</div>
    </div>
  </div>
</div>

<script>
const el=id=>document.getElementById(id);
const setText=(id,t)=>{if(el(id))el(id).textContent=t;};
let pollTimer;

function fetchInfo(){
  const url=el("url").value.trim();
  if(!url)return alert("Enter URL!");
  el("fetch-btn").innerHTML="Fetching <span class='spinner'></span>";
  fetch("/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url})})
  .then(r=>r.json()).then(()=>{
    el("fetch-btn").innerText="Fetched!";
    setText("status","‚úÖ Info fetched. Ready to download.");
    el("fetched-area").style.display="block";
    loadFormats();
  }).catch(()=>setText("status","‚ö†Ô∏è Fetch failed."));
}

function loadFormats(){
  fetch("/info").then(r=>r.json()).then(data=>{
    const vsel=el("video"), asel=el("audio");
    vsel.innerHTML=data.video_formats.map(f=>`<option value="${f.format_id}">${f.resolution || "‚Äî"} (${f.ext})</option>`).join("");
    asel.innerHTML=data.audio_formats.map(f=>`<option value="${f.format_id}">${f.abr||"?"}kbps (${f.ext})</option>`).join("");
    if(data.thumbnail){
      const thumb=el("thumbnail");
      thumb.src=data.thumbnail;
      thumb.style.display="block";
    }
  });
}

function startAudio(){ startDownload("/download_audio","audio-btn","Downloading Audio‚Ä¶"); }
function startVideo(){ startDownload("/download_video","video-btn","Downloading Video‚Ä¶"); }

function startDownload(endpoint,btn,text){
  const url=el("url").value.trim();
  if(!url)return alert("Enter URL!");
  showSpinner(btn,text);
  el("cancel-btn").classList.add("cancel-glow");
  el("progress-section").style.display="block";
  setText("status","‚¨áÔ∏è Download started...");
  fetch(endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url})});
  pollProgress();
}

function cancelDownload(){
  fetch("/cancel",{method:"POST"});
  el("cancel-btn").classList.remove("cancel-glow");
  clearTimeout(pollTimer);
  resetBars();
  setText("status","‚ùå Cancelled.");
  el("complete").innerText="";
  hideSpinner("audio-btn","Download Audio");
  hideSpinner("video-btn","Download Video");
}

function resetApp(){
  const rb=el("reset-btn");
  rb.classList.add("reset-pulse");
  setTimeout(()=>rb.classList.remove("reset-pulse"),800);
  fetch("/reset",{method:"POST"});
  el("cancel-btn").classList.remove("cancel-glow");
  resetBars();
  el("complete").innerText="";
  setText("status","üîÅ Reset done. Ready.");
  hideSpinner("audio-btn","Download Audio");
  hideSpinner("video-btn","Download Video");
}

function showSpinner(id,text){
  const b=el(id);
  b.disabled=true;
  b.classList.add("loading");
  b.innerHTML=`<span class="spinner"></span>${text}`;
}
function hideSpinner(id,text){
  const b=el(id);
  b.disabled=false;
  b.classList.remove("loading");
  b.textContent=text;
}

function pollProgress(){
  fetch("/progress").then(r=>r.json()).then(d=>{
    updatePhase(d.video);
    const done=Object.values(d).some(p=>p.status==="finished");
    if(done){
      fetch("/done").then(r=>r.json()).then(j=>{
        el("cancel-btn").classList.remove("cancel-glow");
        hideSpinner("audio-btn","Download Audio");
        hideSpinner("video-btn","Download Video");
        if(j.filename){
          const fn=j.filename.split(/[\\/]/).pop();
          el("complete").innerHTML=`‚úÖ <b>Download done</b><br>üìÑ ${fn}`;
        } else el("complete").innerText="‚úÖ Download done";
        setText("status","‚úÖ Completed successfully.");
      });
    }else pollTimer=setTimeout(pollProgress,1000);
  }).catch(()=>setTimeout(pollProgress,1500));
}

function updatePhase(info){
  if(!info)return;
  const p=parseFloat((info.percent||"0").replace("%",""))||0;
  el("video-bar").style.width=p+"%";
  setText("video-percent",p.toFixed(1)+"%");
  setText("video-eta","ETA: "+(info.eta||"‚Äî"));
  setText("video-speed","Speed: "+(info.speed||"‚Äî"));
  setText("video-size","Size: "+(info.size||"‚Äî"));
  setText("video-status","Status: "+(info.status||"‚Äî"));
}

function resetBars(){
  el("video-bar").style.width="0%";
  ["video-percent","video-eta","video-speed","video-size","video-status"].forEach(id=>setText(id,"‚Äî"));
}
</script>
</body>
</html>

